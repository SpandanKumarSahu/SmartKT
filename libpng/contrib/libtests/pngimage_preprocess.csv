15,include,<stdarg.h>,
16,include,<stdlib.h>,
17,include,<string.h>,
18,include,<errno.h>,
19,include,<stdio.h>,
20,include,<assert.h>,
22,if,defined(HAVE_CONFIG_H) && !defined(PNG_NO_CONFIG_H),
23,,#  include <config.h>,
24,endif,,
29,ifdef,PNG_FREESTANDING_TESTS,
30,,#  include <png.h>,
31,else,,
32,,"#  include ""../../png.h""",
33,endif,,
35,ifndef,PNG_SETJMP_SUPPORTED,
36,,#  include <setjmp.h> ,/* because png.h did *not* include this */
37,endif,,
42,if,PNG_LIBPNG_VER >= 10601 && defined(HAVE_CONFIG_H),
43,,#  define SKIP 77,
44,else,,
45,,#  define SKIP 0,
46,endif,,
48,if,PNG_LIBPNG_VER < 10700,
50,,#  ifdef PNG_INFO_IMAGE_SUPPORTED,
51,,#     ifdef PNG_SEQUENTIAL_READ_SUPPORTED,
52,,#        define PNG_READ_PNG_SUPPORTED,
53,,#     endif ,/* SEQUENTIAL_READ */
54,,#     ifdef PNG_WRITE_SUPPORTED,
55,,#        define PNG_WRITE_PNG_SUPPORTED,
56,,#     endif ,/* WRITE */
57,,#  endif ,/* INFO_IMAGE */
58,endif,,/* pre 1.7.0 */
60,ifdef,PNG_READ_PNG_SUPPORTED,
97,,#     define CHUNK_NONE 0,
98,,#     define CHUNK_sBIT PNG_INFO_sBIT,
99,,#     define CHUNK_tRNS PNG_INFO_tRNS,
102,,#     define COLOR_MASK_X   0,
103,,#     define COLOR_MASK_P   PNG_COLOR_MASK_PALETTE,
104,,#     define COLOR_MASK_C   PNG_COLOR_MASK_COLOR,
105,,#     define COLOR_MASK_A   PNG_COLOR_MASK_ALPHA,
106,,#     define COLOR_MASK_ALL (PALETTE+COLOR+ALPHA)  ,"/* absent = gray, no alpha */"
108,,#     define BD_ALL  (1 + 2 + 4 + 8 + 16),
109,,#     define BD_PAL  (1 + 2 + 4 + 8),
110,,#     define BD_LOW  (1 + 2 + 4),
111,,#     define BD_16   16,
112,,#     define BD_TRUE (8+16) ,/* i.e. true-color depths */
114,,#     define TRANSFORM_R  1,
115,,#     define TRANSFORM_W  2,
116,,#     define TRANSFORM_RW 3,
124,,"#  define T(name,chunk,cm_required,cm_absent,bd,when) {  #name, PNG_TRANSFORM_ ## name, CHUNK_ ## chunk, COLOR_MASK_ ## cm_required, COLOR_MASK_ ## cm_absent, BD_ ## bd, TRANSFORM_ ## when, 0}",/*!tested*/
129,ifdef,PNG_READ_STRIP_16_TO_8_SUPPORTED,
132,endif,,
133,ifdef,PNG_READ_STRIP_ALPHA_SUPPORTED,
136,endif,,
137,ifdef,PNG_WRITE_PACK_SUPPORTED,
138,,#  define TRANSFORM_RW_PACK TRANSFORM_RW,
139,else,,
140,,#  define TRANSFORM_RW_PACK TRANSFORM_R,
141,endif,,
142,ifdef,PNG_READ_PACK_SUPPORTED,
147,endif,,
148,ifdef,PNG_WRITE_PACKSWAP_SUPPORTED,
149,,#  define TRANSFORM_RW_PACKSWAP TRANSFORM_RW,
150,else,,
151,,#  define TRANSFORM_RW_PACKSWAP TRANSFORM_R,
152,endif,,
153,ifdef,PNG_READ_PACKSWAP_SUPPORTED,
156,endif,,
157,ifdef,PNG_READ_EXPAND_SUPPORTED,
165,endif,,
166,ifdef,PNG_WRITE_INVERT_SUPPORTED,
167,,#  define TRANSFORM_RW_INVERT TRANSFORM_RW,
168,else,,
169,,#  define TRANSFORM_RW_INVERT TRANSFORM_R,
170,endif,,
171,ifdef,PNG_READ_INVERT_SUPPORTED,
174,endif,,
175,ifdef,PNG_WRITE_SHIFT_SUPPORTED,
176,,#  define TRANSFORM_RW_SHIFT TRANSFORM_RW,
177,else,,
178,,#  define TRANSFORM_RW_SHIFT TRANSFORM_R,
179,endif,,
180,ifdef,PNG_READ_SHIFT_SUPPORTED,
187,endif,,
188,ifdef,PNG_WRITE_BGR_SUPPORTED,
189,,#  define TRANSFORM_RW_BGR TRANSFORM_RW,
190,else,,
191,,#  define TRANSFORM_RW_BGR TRANSFORM_R,
192,endif,,
193,ifdef,PNG_READ_BGR_SUPPORTED,
196,endif,,
197,ifdef,PNG_WRITE_SWAP_ALPHA_SUPPORTED,
198,,#  define TRANSFORM_RW_SWAP_ALPHA TRANSFORM_RW,
199,else,,
200,,#  define TRANSFORM_RW_SWAP_ALPHA TRANSFORM_R,
201,endif,,
202,ifdef,PNG_READ_SWAP_ALPHA_SUPPORTED,
207,endif,,
208,ifdef,PNG_WRITE_SWAP_SUPPORTED,
209,,#  define TRANSFORM_RW_SWAP TRANSFORM_RW,
210,else,,
211,,#  define TRANSFORM_RW_SWAP TRANSFORM_R,
212,endif,,
213,ifdef,PNG_READ_SWAP_SUPPORTED,
216,endif,,
217,ifdef,PNG_WRITE_INVERT_ALPHA_SUPPORTED,
218,,#  define TRANSFORM_RW_INVERT_ALPHA TRANSFORM_RW,
219,else,,
220,,#  define TRANSFORM_RW_INVERT_ALPHA TRANSFORM_R,
221,endif,,
222,ifdef,PNG_READ_INVERT_ALPHA_SUPPORTED,
225,endif,,
226,ifdef,PNG_WRITE_FILLER_SUPPORTED,
234,endif,,
235,ifdef,PNG_READ_GRAY_TO_RGB_SUPPORTED,
247,endif,,
248,ifdef,PNG_READ_EXPAND_16_SUPPORTED,
258,endif,,
259,ifdef,PNG_READ_SCALE_16_TO_8_SUPPORTED,
262,endif,,
266,undef,T,
269,define,ARRAY_SIZE(a) ((sizeof a)/(sizeof a[0])),
270,define,TTABLE_SIZE ARRAY_SIZE(transform_info),
363,define,NEW(type) ((type *)malloc(sizeof (type))),
364,define,DELETE(ptr) (free(ptr)),
409,ifdef,PNG_WRITE_PNG_SUPPORTED,
417,endif,,
426,ifdef,ENOMEM ,/* required by POSIX 1003.1 */
427,,#  define MEMORY ENOMEM,
428,else,,
429,,#  define MEMORY ERANGE ,/* required by ANSI-C */
430,endif,,
522,define,LEVEL_MASK      0xf   ,/* where the level is in 'options' */
524,define,EXHAUSTIVE      0x010 ,/* Test all combinations of active options */
525,define,STRICT          0x020 ,/* Fail on warnings as well as errors */
526,define,LOG             0x040 ,/* Log pass/fail to stdout */
527,define,CONTINUE        0x080 ,/* Continue on APP_FAIL errors */
528,define,SKIP_BUGS       0x100 ,/* Skip over known bugs */
529,define,LOG_SKIPPED     0x200 ,/* Log skipped bugs */
530,define,FIND_BAD_COMBOS 0x400 ,/* Attempt to deduce bad combos */
531,define,LIST_COMBOS     0x800 ,/* List combos by name */
537,define,RESULT_STRICT(r)   (((r) & ~((1U<<WARNINGS)-1)) == 0),
538,define,RESULT_RELAXED(r)  (((r) & ~((1U<<ERRORS)-1)) == 0),
579,,#  ifdef PNG_WRITE_PNG_SUPPORTED,
583,,#  endif,
606,,#  ifdef PNG_WRITE_PNG_SUPPORTED,
609,,#  endif,
619,ifdef,PNG_WRITE_PNG_SUPPORTED,
626,endif,,
631,,#  ifdef PNG_WRITE_PNG_SUPPORTED,
633,,#  endif,
649,,#  ifdef PNG_WRITE_PNG_SUPPORTED,
651,,#  endif,
672,ifdef,__GNUC__,
673,,"#  define VGATTR __attribute__((__format__ (__printf__,3,4)))",
677,else,,
678,,#  define VGATTR,
679,endif,,
893,,#  ifdef PNG_SET_USER_LIMITS_SUPPORTED,
896,,#  endif,
904,if,0 ,/* crazy debugging */
918,endif,,
1006,,"#  define C(item) if (item != dp->item) display_log(dp, APP_WARNING, ""IHDR "" #item ""(%lu) changed to %lu"", (unsigned long)dp->item, (unsigned long)item), e = #item",
1096,,#     ifdef PNG_sBIT_SUPPORTED,
1258,,#     else ,/* !sBIT */
1261,,#     endif ,/* !sBIT */
1267,ifdef,PNG_WRITE_PNG_SUPPORTED,
1337,,#  ifdef PNG_SET_USER_LIMITS_SUPPORTED,
1340,,#  endif,
1366,endif,,/* WRITE_PNG */
1428,ifdef,PNG_WRITE_PNG_SUPPORTED,
1438,endif,,
1469,ifdef,PNG_WRITE_PNG_SUPPORTED,
1501,endif,,
1705,else,,/* !READ_PNG */
1712,endif,,
