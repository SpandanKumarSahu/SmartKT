34,define,_POSIX_SOURCE 1,
36,include,<stdio.h>,
37,include,<stdlib.h>,
38,include,<string.h>,
42,define,STDERR stdout   ,/* For DOS */
44,include,"""png.h""",
54,if,defined PNG_READ_SUPPORTED && defined PNG_READ_bKGD_SUPPORTED && defined PNG_READ_cHRM_SUPPORTED && defined PNG_READ_gAMA_SUPPORTED && defined PNG_READ_oFFs_SUPPORTED && defined PNG_READ_pCAL_SUPPORTED && defined PNG_READ_pHYs_SUPPORTED && defined PNG_READ_sBIT_SUPPORTED && defined PNG_READ_sCAL_SUPPORTED && defined PNG_READ_sRGB_SUPPORTED && defined PNG_READ_sPLT_SUPPORTED && defined PNG_READ_tEXt_SUPPORTED && defined PNG_READ_tIME_SUPPORTED && defined PNG_READ_zTXt_SUPPORTED && (defined PNG_WRITE_INTERLACING_SUPPORTED || PNG_LIBPNG_VER >= 10700),/* else nothing can be done */
70,ifdef,PNG_ZLIB_HEADER,
71,,#  include PNG_ZLIB_HEADER ,/* defined by pnglibconf.h from 1.7 */
72,else,,
73,,"#  include ""zlib.h""",
74,endif,,
77,ifndef,PNG_ZBUF_SIZE,
78,,#  define PNG_ZBUF_SIZE 8192,
79,endif,,
80,define,FCLOSE(file) fclose(file),
82,ifndef,PNG_STDIO_SUPPORTED,
84,endif,,
87,ifndef,PNG_DEBUG,
88,,#  define PNG_DEBUG 0,
89,endif,,
91,if,PNG_DEBUG > 1,
92,,"#  define pngtest_debug(m)        ((void)fprintf(stderr, m ""\n""))",
93,,"#  define pngtest_debug1(m,p1)    ((void)fprintf(stderr, m ""\n"", p1))",
94,,"#  define pngtest_debug2(m,p1,p2) ((void)fprintf(stderr, m ""\n"", p1, p2))",
95,else,,
96,,#  define pngtest_debug(m)        ((void)0),
97,,"#  define pngtest_debug1(m,p1)    ((void)0)",
98,,"#  define pngtest_debug2(m,p1,p2) ((void)0)",
99,endif,,
101,if,!PNG_DEBUG,
102,,#  define SINGLE_ROWBUF_ALLOC  ,/* Makes buffer overruns easier to nail */
103,endif,,
105,ifndef,PNG_UNUSED,
106,,#  define PNG_UNUSED(param) (void)param;,
107,endif,,
110,define,PNGTEST_TIMING,
113,ifndef,PNG_FLOATING_POINT_SUPPORTED,
114,undef,PNGTEST_TIMING,
115,endif,,
117,ifdef,PNGTEST_TIMING,
119,include,<time.h>,
120,endif,,
122,ifdef,PNG_TIME_RFC1123_SUPPORTED,
123,define,PNG_tIME_STRING_LENGTH 29,
127,if,PNG_LIBPNG_VER < 10619,
128,define,"png_convert_to_rfc1123_buffer(ts, t) tIME_to_str(read_ptr, ts, t)",
141,endif,,/* older libpng */
142,endif,,
153,ifndef,png_jmpbuf,
154,,#  define png_jmpbuf(png_ptr) png_ptr->jmpbuf,
155,endif,,
158,ifndef,PNG_HANDLE_CHUNK_ALWAYS,
159,,#  define PNG_HANDLE_CHUNK_ALWAYS       3,
160,endif,,
161,ifndef,PNG_HANDLE_CHUNK_IF_SAFE,
162,,#  define PNG_HANDLE_CHUNK_IF_SAFE      2,
163,endif,,
166,define,"MEMZERO(var) ((void)memset(&var, 0, sizeof var))",
197,ifdef,PNG_WRITE_SUPPORTED,
206,endif,,
209,ifdef,PNG_READ_USER_TRANSFORM_SUPPORTED,
219,endif,,
221,ifdef,PNG_WRITE_USER_TRANSFORM_SUPPORTED,
334,endif,,/* WRITE_USER_TRANSFORM */
336,ifndef,PNG_STDIO_SUPPORTED,
346,ifdef,PNG_IO_STATE_SUPPORTED,
386,endif,,
408,ifdef,PNG_IO_STATE_SUPPORTED,
410,endif,,
413,ifdef,PNG_WRITE_FLUSH_SUPPORTED,
420,endif,,
439,ifdef,PNG_IO_STATE_SUPPORTED,
441,endif,,
443,endif,,/* !STDIO */
489,if,defined(PNG_USER_MEM_SUPPORTED) && PNG_DEBUG,
581,if,0 ,/* This happens all the time. */
583,endif,,
628,endif,,/* USER_MEM && DEBUG */
632,ifdef,PNG_READ_USER_CHUNKS_SUPPORTED,
649,define,have_sTER   0x01,
650,define,have_vpAg   0x02,
651,define,before_PLTE 0x10,
652,define,before_IDAT 0x20,
653,define,after_IDAT  0x40,
752,ifdef,PNG_WRITE_SUPPORTED,
803,endif,,/* WRITE */
804,else,,/* !READ_USER_CHUNKS */
805,,"#  define write_chunks(pp,loc) ((void)0)",
806,endif,,
813,ifdef,PNG_TEXT_SUPPORTED,
826,,#           ifndef PNG_WRITE_zTXt_SUPPORTED,
830,,#           endif,
835,,#           ifndef PNG_WRITE_iTXt_SUPPORTED,
838,,#           endif,
848,endif,,
860,ifdef,PNG_WRITE_SUPPORTED,
864,ifdef,PNG_WRITE_FILTER_SUPPORTED,
866,endif,,/* WRITE_FILTER */
867,else,,/* !WRITE */
871,endif,,/* !WRITE */
896,if,defined(PNG_USER_MEM_SUPPORTED) && PNG_DEBUG,
900,else,,
903,endif,,
907,ifdef,PNG_WRITE_SUPPORTED,
908,if,defined(PNG_USER_MEM_SUPPORTED) && PNG_DEBUG,
912,else,,
915,endif,,
918,endif,,
922,ifdef,PNG_WRITE_SUPPORTED,
925,endif,,
927,ifdef,PNG_READ_USER_CHUNKS_SUPPORTED,
931,endif,,
933,ifdef,PNG_SETJMP_SUPPORTED,
943,ifdef,PNG_WRITE_SUPPORTED,
948,endif,,
954,ifdef,PNG_WRITE_SUPPORTED,
973,endif,,
974,endif,,
976,ifdef,PNG_BENIGN_ERRORS_SUPPORTED,
982,,# ifdef PNG_WRITE_SUPPORTED,
985,,# endif,
1001,ifdef,PNG_IGNORE_ADLER32,
1004,endif,,
1006,,# ifdef PNG_WRITE_SUPPORTED,
1008,,# endif,
1011,endif,,/* BENIGN_ERRORS */
1014,ifdef,PNG_STDIO_SUPPORTED,
1016,,#  ifdef PNG_WRITE_SUPPORTED,
1018,,#  endif,
1019,else,,
1021,,#  ifdef PNG_WRITE_SUPPORTED,
1023,,#    ifdef PNG_WRITE_FLUSH_SUPPORTED,
1025,,#    else,
1027,,#    endif,
1028,,#  endif,
1029,endif,,
1033,ifdef,PNG_WRITE_SUPPORTED,
1035,endif,,
1041,ifdef,PNG_WRITE_SUPPORTED,
1043,endif,,
1047,ifdef,PNG_READ_USER_TRANSFORM_SUPPORTED,
1049,endif,,
1050,ifdef,PNG_WRITE_USER_TRANSFORM_SUPPORTED,
1053,endif,,
1055,ifdef,PNG_SET_UNKNOWN_CHUNKS_SUPPORTED,
1064,ifdef,PNG_SAVE_UNKNOWN_CHUNKS_SUPPORTED,
1067,endif,,
1068,ifdef,PNG_WRITE_UNKNOWN_CHUNKS_SUPPORTED,
1071,endif,,
1072,endif,,
1077,ifdef,PNG_READ_USER_CHUNKS_SUPPORTED,
1084,endif,,
1117,ifdef,PNG_FIXED_POINT_SUPPORTED,
1118,ifdef,PNG_cHRM_SUPPORTED,
1130,endif,,
1131,ifdef,PNG_gAMA_SUPPORTED,
1138,endif,,
1139,else,,/* Use floating point versions */
1140,ifdef,PNG_FLOATING_POINT_SUPPORTED,
1141,ifdef,PNG_cHRM_SUPPORTED,
1153,endif,,
1154,ifdef,PNG_gAMA_SUPPORTED,
1161,endif,,
1162,endif,,/* Floating point */
1163,endif,,/* Fixed point */
1164,ifdef,PNG_iCCP_SUPPORTED,
1178,endif,,
1179,ifdef,PNG_sRGB_SUPPORTED,
1186,endif,,
1194,ifdef,PNG_bKGD_SUPPORTED,
1203,endif,,
1204,ifdef,PNG_READ_eXIf_SUPPORTED,
1214,,# ifdef PNG_WRITE_eXIf_SUPPORTED,
1216,,# endif,
1219,endif,,
1220,ifdef,PNG_hIST_SUPPORTED,
1227,endif,,
1228,ifdef,PNG_oFFs_SUPPORTED,
1239,endif,,
1240,ifdef,PNG_pCAL_SUPPORTED,
1254,endif,,
1255,ifdef,PNG_pHYs_SUPPORTED,
1264,endif,,
1265,ifdef,PNG_sBIT_SUPPORTED,
1272,endif,,
1273,ifdef,PNG_sCAL_SUPPORTED,
1274,if,defined(PNG_FLOATING_POINT_SUPPORTED) && defined(PNG_FLOATING_ARITHMETIC_SUPPORTED),
1286,else,,
1287,ifdef,PNG_FIXED_POINT_SUPPORTED,
1299,endif,,
1300,endif,,
1301,endif,,
1303,ifdef,PNG_sPLT_SUPPORTED,
1313,endif,,
1315,ifdef,PNG_TEXT_SUPPORTED,
1341,endif,,
1342,ifdef,PNG_tIME_SUPPORTED,
1349,ifdef,PNG_TIME_RFC1123_SUPPORTED,
1360,endif,,/* TIME_RFC1123 */
1363,endif,,
1364,ifdef,PNG_tRNS_SUPPORTED,
1385,endif,,
1386,ifdef,PNG_WRITE_UNKNOWN_CHUNKS_SUPPORTED,
1396,if,PNG_LIBPNG_VER < 10600,
1407,endif,,
1410,endif,,
1412,ifdef,PNG_WRITE_SUPPORTED,
1430,ifdef,PNG_COMPRESSION_COMPAT,
1433,endif,,
1434,endif,,
1436,ifdef,SINGLE_ROWBUF_ALLOC,
1442,endif,,/* SINGLE_ROWBUF_ALLOC */
1445,if,defined(PNG_READ_INTERLACING_SUPPORTED) && defined(PNG_WRITE_INTERLACING_SUPPORTED),
1457,else,,/* png_set_interlace_handling not called on either read or write */
1458,,#  define calc_pass_height,
1459,endif,,/* not using libpng interlace handling */
1461,ifdef,PNGTEST_TIMING,
1465,endif,,
1468,,#     ifdef calc_pass_height,
1482,,#     else,
1483,,#        define pass_height height,
1484,,#     endif,
1489,ifndef,SINGLE_ROWBUF_ALLOC,
1498,endif,,/* !SINGLE_ROWBUF_ALLOC */
1501,ifdef,PNG_WRITE_SUPPORTED,
1502,ifdef,PNGTEST_TIMING,
1506,endif,,
1508,ifdef,PNGTEST_TIMING,
1512,endif,,
1513,endif,,/* WRITE */
1515,ifndef,SINGLE_ROWBUF_ALLOC,
1519,endif,,/* !SINGLE_ROWBUF_ALLOC */
1523,ifdef,PNG_STORE_UNKNOWN_CHUNKS_SUPPORTED,
1524,,#  ifdef PNG_READ_UNKNOWN_CHUNKS_SUPPORTED,
1526,,#  endif,
1527,,#  ifdef PNG_WRITE_UNKNOWN_CHUNKS_SUPPORTED,
1529,,#  endif,
1530,endif,,
1535,ifdef,PNG_TEXT_SUPPORTED,
1561,endif,,
1562,ifdef,PNG_READ_eXIf_SUPPORTED,
1572,,# ifdef PNG_WRITE_eXIf_SUPPORTED,
1574,,# endif,
1577,endif,,
1578,ifdef,PNG_tIME_SUPPORTED,
1585,ifdef,PNG_TIME_RFC1123_SUPPORTED,
1596,endif,,/* TIME_RFC1123 */
1599,endif,,
1600,ifdef,PNG_WRITE_UNKNOWN_CHUNKS_SUPPORTED,
1610,if,PNG_LIBPNG_VER < 10600,
1621,endif,,
1624,endif,,
1626,ifdef,PNG_WRITE_SUPPORTED,
1627,ifdef,PNG_WRITE_CUSTOMIZE_ZTXT_COMPRESSION_SUPPORTED,
1633,endif,,
1644,endif,,
1646,ifdef,PNG_EASY_ACCESS_SUPPORTED,
1655,endif,,
1658,ifdef,SINGLE_ROWBUF_ALLOC,
1662,endif,,/* SINGLE_ROWBUF_ALLOC */
1665,ifdef,PNG_WRITE_SUPPORTED,
1670,endif,,
1692,,#  ifdef PNG_WRITE_SUPPORTED,
1699,,#  endif,
1724,if,defined (PNG_WRITE_SUPPORTED) && defined (PNG_WRITE_FILTER_SUPPORTED),/* else nothing was written */
1804,endif,,/* WRITE && WRITE_FILTER */
1813,ifdef,RISCOS,
1816,else,,
1819,endif,,
1846,if,defined(MAXSEG_64K) && !defined(PNG_MAX_MALLOC_64K),
1848,endif,,
1850,if,!defined(MAXSEG_64K) && defined(PNG_MAX_MALLOC_64K),
1852,endif,,
1942,if,defined(PNG_USER_MEM_SUPPORTED) && PNG_DEBUG,
1944,endif,,
1949,if,PNG_DEBUG > 0,
1951,endif,,
1955,ifdef,PNG_WRITE_USER_TRANSFORM_SUPPORTED,
1958,else,,
1960,endif,,
1961,ifdef,PNG_TIME_RFC1123_SUPPORTED,
1966,endif,,/* TIME_RFC1123 */
1979,if,defined(PNG_USER_MEM_SUPPORTED) && PNG_DEBUG,
1999,endif,,
2001,if,defined(PNG_USER_MEM_SUPPORTED) && PNG_DEBUG,
2010,endif,,
2019,if,defined(PNG_USER_MEM_SUPPORTED) && PNG_DEBUG,
2021,endif,,
2031,if,PNG_DEBUG > 0,
2033,endif,,
2042,ifdef,PNG_WRITE_USER_TRANSFORM_SUPPORTED,
2045,else,,
2047,endif,,
2048,ifdef,PNG_TIME_RFC1123_SUPPORTED,
2051,endif,,/* TIME_RFC1123 */
2060,if,PNG_DEBUG > 0,
2062,endif,,
2073,if,defined(PNG_USER_MEM_SUPPORTED) && PNG_DEBUG,
2092,endif,,
2094,if,defined(PNG_USER_MEM_SUPPORTED) && PNG_DEBUG,
2103,endif,,
2106,ifdef,PNGTEST_TIMING,
2118,endif,,
2146,else,,
2155,endif,,
